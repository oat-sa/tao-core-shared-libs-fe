CKEDITOR.dialog.add("interactionsourcedialog",function(f){var n;function x(a){var c=f.lang.interactionsource,b={isValid:!0,error:null};try{if(-1===a.indexOf("\x3cinteraction_"))return b.isValid=!1,b.error=c.missingInteraction,b;var d=(a.match(/<div/g)||[]).length,e=(a.match(/<\/div>/g)||[]).length;if(d!==e)return b.isValid=!1,b.error=d>e?c.missingClosingTag+": "+c.missingDivClosingTags.replace("{0}",d-e):c.missingOpeningTag+": "+c.missingDivOpeningTags.replace("{0}",e-d),b;var q=a.match(/<\/?([a-z][a-z0-9_]*)[^>]*>/gi);
if(q){for(var d="div span p br hr strong em i b u s code pre".split(" "),e=[],k=0;k<q.length;k++){var g=q[k].match(/<\/?([a-z][a-z0-9_]*)[^>]*>/i);if(g&&g[1]){var h=g[1].toLowerCase();0!==h.indexOf("interaction_")&&-1===d.indexOf(h)&&-1===e.indexOf(h)&&e.push(h)}}if(0<e.length)return b.isValid=!1,b.error=c.invalidTags+": "+e.join(", "),b}var q=[],l=a.split("\n");for(a=0;a<l.length;a++){var m=l[a].match(/<\/?([a-z][a-z0-9_]*)[^>]*>/gi);if(m)for(g=0;g<m.length;g++){var r=m[g];if(-1===r.indexOf("/\x3e")&&
0!==r.indexOf("\x3cinteraction_")&&0!==r.indexOf("\x3c/interaction_"))if(0===r.indexOf("\x3c/")){var n=r.match(/<\/([a-z][a-z0-9_]*)[^>]*>/i);if(n&&n[1]){var t=n[1].toLowerCase();if(0===q.length||q.pop()!==h)return b.isValid=!1,b.error=c.unmatchedClosingTag+": "+t+" ("+c.line+" "+(a+1)+")",b}}else{var p=r.match(/<([a-z][a-z0-9_]*)[^>]*>/i);if(p&&p[1]){var u=p[1].toLowerCase();q.push(u)}}}}0<q.length&&(b.isValid=!1,b.error=c.unclosedTags+": "+q.join(", "));return b}catch(v){return b.isValid=!1,b.error=
c.generalValidationError+": "+v.message,b}}function t(a,c){var b=a.getContentElement("main","errorContainer");if(b&&b.getElement())if(b=b.getElement(),c){var d='\x3cdiv style\x3d"'+g.css.errorMessage+'"\x3e\x3cstrong\x3e'+f.lang.interactionsource.validationError+":\x3c/strong\x3e "+c.replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;")+"\x3c/div\x3e";b.setHtml(d);b.show()}else b.setHtml(""),b.hide()}function p(a){var c=a.getValueOf("main","data"),c=x(c);t(a,c.isValid?null:c.error);return c.isValid}function u(a,
c){return a.replace(/\{\{(\w+)}}/g,function(a,d){return void 0!==c[d]?c[d]:a})}function v(a,c,b){CKEDITOR.plugins.get("alertdialog")?a.openDialog("alertdialog",function(a){a.setValueOf("info","msg",c);if(b)a.once("hide",b)}):(alert(c),b&&b())}function m(a,c){return a&&"function"===typeof a[c]}function h(a,c,b){b=b||"";if(m(a,"getAttribute"))try{var d=a.getAttribute(c);return null!==d?d:b}catch(e){}return b}function y(a){if(!a||!m(a,"getName")||"div"!==a.getName())return!1;var c=h(a,"class","");a=
h(a,"data-units","");if(-1!==c.indexOf("col-12")&&"12"===a)return!0;for(a=0;a<g.boundaryClasses.length;a++)if(-1!==c.indexOf(g.boundaryClasses[a]))return!0;return!1}function w(){m(f,"findInteractionAndWrapper")&&f.findInteractionAndWrapper()}function z(a){var c=h(a,"data-serial"),c=c||"",b;w();if(a&&m(a,"getName")){b=[];for(var d=a,e=10;d&&0<e;){d=m(d,"getParent")?d.getParent():null;if(!d)break;if(m(d,"getName")&&"div"===d.getName()){if(y(d))break;h(d,"data-qti-class")||h(d,"data-html-editable")||
b.push(d)}e--}if(0<b.length){a=(a=h(a,"data-serial"))||"";for(var d=e="",f=b.length-1;0<=f;f--){var k=b[f],n=h(k,"class",""),p=h(k,"id","");var l=k,k="";if(l&&m(l,"getAttributes"))try{var t=l.getAttributes(),l=void 0;for(l in t)0===l.indexOf("data-")&&"data-qti-class"!==l&&(k+=" "+l+'\x3d"'+t[l]+'"')}catch(r){console.error("Error collecting data attributes:",r)}e+="\x3cdiv";n&&(e+=' class\x3d"'+n+'"');p&&(e+=' id\x3d"'+p+'"');k&&(e+=k);e+="\x3e\n";d+="\x3c/div\x3e\n"}b={wrappers:b,placeholder:u(g.placeholderTemplate,
{wrapperDivs:e,serialId:a,closingDivs:d})}}else b=null}else b=null;return b?b.placeholder:u(g.simpleTemplate,{serialId:c})}var g={size:{width:Math.min(CKEDITOR.document.getWindow().getViewPaneSize().width-70,800),height:CKEDITOR.document.getWindow().getViewPaneSize().height/1.5},placeholderTemplate:"{{wrapperDivs}}\x3cinteraction_{{serialId}}\x3e\n{{closingDivs}}",simpleTemplate:"\x3cinteraction_{{serialId}}\x3e",css:{wrapperInfo:"margin-bottom: 10px; padding: 5px; border-left: 3px solid #ccc; background-color: #f9f9f9;",
example:"margin: 3px 0 0; color: #666; font-style: italic;",codeBlock:"display: block; margin-top: 5px; padding: 5px; background: #f0f0f0; border: 1px solid #ddd; font-family: monospace;",textarea:"cursor:auto; width:100%; min-width:{{width}}px; max-width:unset; height:{{height}}px; tab-size:4; text-align:left; font-family:monospace;",errorMessage:"padding: 8px; margin-top: 8px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 4px;"},boundaryClasses:["col-12","grid-row",
"qti-itemBody","item-editor-drop-area"]};n=null;return{title:f.lang.interactionsource.title,minWidth:600,minHeight:400,resizable:CKEDITOR.DIALOG_RESIZE_BOTH,onShow:function(){var a=this;w();var c=f.interactionElement;if(c)try{var b=z(c);this.setValueOf("main","data",b);n=b;t(a,null)}catch(d){console.error("Error getting simplified interaction HTML:",d),v(f,f.lang.interactionsource.retrieveError+": "+d.message),setTimeout(function(){a.hide()},0)}else v(f,f.lang.interactionsource.noInteractionFound),
setTimeout(function(){a.hide()},0)},onOk:function(){if(this.getValueOf("main","data").replace(/\r/g,"")===n)return!0;if(!p(this))return!1;var a;if(p(this)){f.focus();try{var c=this.getValueOf("main","data");if(!c)throw Error(f.lang.interactionsource.noEditedData);if(!f.interactionElement)throw Error(f.lang.interactionsource.noInteractionFound);var b=CKEDITOR.htmlParser.fragment.fromHtml(c),d=1===b.children.length&&"div"===b.children[0].name;if(d){var e=b.children[0];f.lastWrapperClass=e.attributes&&
e.attributes["class"]||""}f.lastInteractionHasWrapper=d;this.hide();f.fire("pluginContentModified",{html:c,pluginName:"interactionsourcedialog"});a=!0}catch(g){console.error("Error applying changes:",g),t(this,f.lang.interactionsource.updateError+": "+g.message),a=!1}}else a=!1;return a},contents:[{id:"main",label:f.lang.interactionsource.title,elements:[{type:"html",id:"wrapperInfo",html:function(){var a=f.lang.interactionsource;return'\x3cdiv id\x3d"interaction-wrapper-info" style\x3d"'+g.css.wrapperInfo+
'"\x3e\x3cp style\x3d"'+g.css.example+'"\x3e'+a.wrapperExample+'\x3cbr\x3e\x3ccode style\x3d"'+g.css.codeBlock+'"\x3e\x26lt;div class\x3d"outer-wrapper"\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26lt;div class\x3d"middle-wrapper"\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26lt;div class\x3d"inner-wrapper"\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26lt;interaction_serial_number\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26lt;/div\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26lt;/div\x26gt;\x3cbr\x3e\x26lt;/div\x26gt;\x3c/code\x3e\x3c/p\x3e\x3cp style\x3d"'+
g.css.example+'"\x3e\x3cem\x3e'+a.styleEditorNote+"\x3c/em\x3e\x3c/p\x3e\x3c/div\x3e"}()},{type:"textarea",id:"data",dir:"ltr",inputStyle:u(g.css.textarea,g.size),"class":"cke_source",onKeyUp:function(){p(this.getDialog())}},{type:"html",id:"errorContainer",html:"",style:"display:none"}]}]}});