CKEDITOR.dialog.add("interactionsourcedialog",function(b){function h(a,c){return a.replace(/\{\{(\w+)\}\}/g,function(a,b){return void 0!==c[b]?c[b]:a})}function k(a,c,e){CKEDITOR.plugins.get("alertdialog")?a.openDialog("alertdialog",function(a){a.setValueOf("info","msg",c);if(e)a.once("hide",e)}):(alert(c),e&&e())}function g(a,c){return a&&"function"===typeof a[c]}function f(a,c,e){e=e||"";if(g(a,"getAttribute"))try{var b=a.getAttribute(c);return null!==b?b:e}catch(d){}return e}function q(a){m();
if(b.interactionWrapper)return l(b.interactionWrapper,a);var c=g(a,"getParent")?a.getParent():null;return c&&n(c)?l(c,a):(c=r(a))?l(c,a):null}function l(a,c){var e=f(a,"class"),b=f(c,"data-serial");return{wrapper:a,placeholder:h(d.placeholderTemplate,{className:e,serialId:b})}}function n(a){if(!a)return!1;try{return g(a,"getName")&&"div"===a.getName()&&!f(a,"data-qti-class")}catch(c){return!1}}function r(a){if(!g(a,"getParent"))return null;try{for(var c=5;a&&0<c;){var b=a.getParent();if(n(b)&&(g(b,
"hasClass")&&b.hasClass("custom-interaction-wrapper")||f(b,"class")&&!f(b,"data-serial")&&!f(b,"data-html-editable")))return b;a=b;c--}return null}catch(d){return console.error("Error in findClosestWrapperDiv:",d),null}}function m(){g(b,"findInteractionAndWrapper")&&b.findInteractionAndWrapper()}function t(a,c){var e=f(a,"data-serial");return b.lastInteractionHasWrapper&&b.lastWrapperClass&&!c?h(d.placeholderTemplate,{className:b.lastWrapperClass,serialId:e}):c?c.placeholder:h(d.simpleTemplate,{serialId:e})}
var d={size:{width:Math.min(CKEDITOR.document.getWindow().getViewPaneSize().width-70,800),height:CKEDITOR.document.getWindow().getViewPaneSize().height/1.5},placeholderTemplate:'\x3cdiv class\x3d"{{className}}"\x3e\n\x3cinteraction_{{serialId}}\x3e\n\x3c/div\x3e',simpleTemplate:"\x3cinteraction_{{serialId}}\x3e",css:{wrapperInfo:"margin-bottom: 10px; padding: 5px; border-left: 3px solid #ccc; background-color: #f9f9f9;",example:"margin: 3px 0 0; color: #666; font-style: italic;",codeBlock:"display: block; margin-top: 5px; padding: 5px; background: #f0f0f0; border: 1px solid #ddd; font-family: monospace;",
textarea:"cursor:auto; width:100%; min-width:{{width}}px; max-width:unset; height:{{height}}px; tab-size:4; text-align:left; font-family:monospace;"}},p=null;return{title:b.lang.interactionsource.title,minWidth:600,minHeight:400,resizable:CKEDITOR.DIALOG_RESIZE_BOTH,onShow:function(){var a=this;m();var c=b.interactionElement;if(c)try{var e=q(c),d=t(c,e);this.setValueOf("main","data",d);p=d}catch(f){console.error("Error getting simplified interaction HTML:",f),k(b,"Error retrieving simplified interaction HTML: "+
f.message),setTimeout(function(){a.hide()},0)}else k(b,"No interaction found or not currently editing an interaction."),setTimeout(function(){a.hide()},0)},onOk:function(){var a=this;if(this.getValueOf("main","data").replace(/\r/g,"")===p)return!0;setTimeout(function(){b.focus();try{var c=a.getValueOf("main","data");if(!c)throw Error("No edited data available");if(!b.interactionElement)throw Error("Interaction element not found.");var e=/^\s*<div[^>]*>([\s\S]*)<\/div>\s*$/i.test(c);if(b.lastInteractionHasWrapper=
e){var d=c.match(/^\s*<div[^>]*class=["']([^"']*)["'][^>]*>/i);d&&d[1]&&(b.lastWrapperClass=d[1])}a.hide();b.fire("pluginContentModified",{html:c,pluginName:"interactionsourcedialog"})}catch(f){console.error("Error applying changes:",f),k(b,"Error updating interaction: "+f.message)}});return!1},contents:[{id:"main",label:b.lang.interactionsource.title,elements:[{type:"html",id:"wrapperInfo",html:function(){var a=b.lang.interactionsource;return'\x3cdiv id\x3d"interaction-wrapper-info" style\x3d"'+
d.css.wrapperInfo+'"\x3e\x3cp style\x3d"'+d.css.example+'"\x3e'+a.wrapperExample+'\x3cbr\x3e\x3ccode style\x3d"'+d.css.codeBlock+'"\x3e\x26lt;div class\x3d"foobar"\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26lt;interaction_serial_number\x26gt;\x3cbr\x3e\x26lt;/div\x26gt;\x3c/code\x3e\x3c/p\x3e\x3cp style\x3d"'+d.css.example+'"\x3e\x3cem\x3e'+a.styleEditorNote+"\x3c/em\x3e\x3c/p\x3e\x3c/div\x3e"}()},{type:"textarea",id:"data",dir:"ltr",inputStyle:h(d.css.textarea,d.size),"class":"cke_source"}]}]}});