CKEDITOR.dialog.add("interactionsourcedialog",function(e){function q(a,d){return a.replace(/\{\{(\w+)}}/g,function(a,c){return void 0!==d[c]?d[c]:a})}function n(a,d,b){CKEDITOR.plugins.get("alertdialog")?a.openDialog("alertdialog",function(a){a.setValueOf("info","msg",d);if(b)a.once("hide",b)}):(alert(d),b&&b())}function m(a,d){return a&&"function"===typeof a[d]}function k(a,d,b){b=b||"";if(m(a,"getAttribute"))try{var c=a.getAttribute(d);return null!==c?c:b}catch(f){}return b}function v(a){if(!a||
!m(a,"getName")||"div"!==a.getName())return!1;var d=k(a,"class","");a=k(a,"data-units","");if(-1!==d.indexOf("col-12")&&"12"===a)return!0;for(a=0;a<g.boundaryClasses.length;a++)if(-1!==d.indexOf(g.boundaryClasses[a]))return!0;return!1}function t(){m(e,"findInteractionAndWrapper")&&e.findInteractionAndWrapper()}function r(a){var d=k(a,"data-serial"),d=d||"",b;t();if(a&&m(a,"getName")){b=[];for(var c=a,f=10;c&&0<f;){c=m(c,"getParent")?c.getParent():null;if(!c)break;if(m(c,"getName")&&"div"===c.getName()){if(v(c))break;
k(c,"data-qti-class")||k(c,"data-html-editable")||b.push(c)}f--}if(0<b.length){a=(a=k(a,"data-serial"))||"";for(var c=f="",e=b.length-1;0<=e;e--){var l=b[e],n=k(l,"class",""),p=k(l,"id","");var h=l,l="";if(h&&m(h,"getAttributes"))try{var u=h.getAttributes(),h=void 0;for(h in u)0===h.indexOf("data-")&&"data-qti-class"!==h&&(l+=" "+h+'\x3d"'+u[h]+'"')}catch(r){console.error("Error collecting data attributes:",r)}f+="\x3cdiv";n&&(f+=' class\x3d"'+n+'"');p&&(f+=' id\x3d"'+p+'"');l&&(f+=l);f+="\x3e\n";
c+="\x3c/div\x3e\n"}b={wrappers:b,placeholder:q(g.placeholderTemplate,{wrapperDivs:f,serialId:a,closingDivs:c})}}else b=null}else b=null;return b?b.placeholder:q(g.simpleTemplate,{serialId:d})}var g={size:{width:Math.min(CKEDITOR.document.getWindow().getViewPaneSize().width-70,800),height:CKEDITOR.document.getWindow().getViewPaneSize().height/1.5},placeholderTemplate:"{{wrapperDivs}}\x3cinteraction_{{serialId}}\x3e\n{{closingDivs}}",simpleTemplate:"\x3cinteraction_{{serialId}}\x3e",css:{wrapperInfo:"margin-bottom: 10px; padding: 5px; border-left: 3px solid #ccc; background-color: #f9f9f9;",
example:"margin: 3px 0 0; color: #666; font-style: italic;",codeBlock:"display: block; margin-top: 5px; padding: 5px; background: #f0f0f0; border: 1px solid #ddd; font-family: monospace;",textarea:"cursor:auto; width:100%; min-width:{{width}}px; max-width:unset; height:{{height}}px; tab-size:4; text-align:left; font-family:monospace;"},boundaryClasses:["col-12","grid-row","qti-itemBody","item-editor-drop-area"]},p=null;return{title:e.lang.interactionsource.title,minWidth:600,minHeight:400,resizable:CKEDITOR.DIALOG_RESIZE_BOTH,
onShow:function(){var a=this;t();var d=e.interactionElement;if(d)try{var b=r(d);this.setValueOf("main","data",b);p=b}catch(c){console.error("Error getting simplified interaction HTML:",c),n(e,"Error retrieving simplified interaction HTML: "+c.message),setTimeout(function(){a.hide()},0)}else n(e,"No interaction found or not currently editing an interaction."),setTimeout(function(){a.hide()},0)},onOk:function(){if(this.getValueOf("main","data").replace(/\r/g,"")===p)return!0;e.focus();try{var a=this.getValueOf("main",
"data");if(!a)throw Error("No edited data available");if(!e.interactionElement)throw Error("Interaction element not found.");var d=CKEDITOR.htmlParser.fragment.fromHtml(a),b=1===d.children.length&&"div"===d.children[0].name;if(b){var c=d.children[0];e.lastWrapperClass=c.attributes&&c.attributes["class"]||""}e.lastInteractionHasWrapper=b;this.hide();e.fire("pluginContentModified",{html:a,pluginName:"interactionsourcedialog"})}catch(f){console.error("Error applying changes:",f),n(e,"Error updating interaction: "+
f.message)}return!1},contents:[{id:"main",label:e.lang.interactionsource.title,elements:[{type:"html",id:"wrapperInfo",html:function(){var a=e.lang.interactionsource;return'\x3cdiv id\x3d"interaction-wrapper-info" style\x3d"'+g.css.wrapperInfo+'"\x3e\x3cp style\x3d"'+g.css.example+'"\x3e'+a.wrapperExample+'\x3cbr\x3e\x3ccode style\x3d"'+g.css.codeBlock+'"\x3e\x26lt;div class\x3d"outer-wrapper"\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26lt;div class\x3d"middle-wrapper"\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26lt;div class\x3d"inner-wrapper"\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26lt;interaction_serial_number\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26lt;/div\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26lt;/div\x26gt;\x3cbr\x3e\x26lt;/div\x26gt;\x3c/code\x3e\x3c/p\x3e\x3cp style\x3d"'+
g.css.example+'"\x3e\x3cem\x3e'+a.styleEditorNote+"\x3c/em\x3e\x3c/p\x3e\x3c/div\x3e"}()},{type:"textarea",id:"data",dir:"ltr",inputStyle:q(g.css.textarea,g.size),"class":"cke_source"}]}]}});