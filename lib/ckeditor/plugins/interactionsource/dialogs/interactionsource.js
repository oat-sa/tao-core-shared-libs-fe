CKEDITOR.dialog.add("interactionsourcedialog",function(e){function k(a,b){return a.replace(/\{\{(\w+)\}\}/g,function(a,d){return void 0!==b[d]?b[d]:a})}function l(a,b,c){CKEDITOR.plugins.get("alertdialog")?a.openDialog("alertdialog",function(a){a.setValueOf("info","msg",b);if(c)a.once("hide",c)}):(alert(b),c&&c())}function h(a,b){return a&&"function"===typeof a[b]}function g(a,b,c){c=c||"";if(h(a,"getAttribute"))try{var d=a.getAttribute(b);return null!==d?d:c}catch(e){}return c}function r(a){n();
if(!a||!h(a,"getName"))return null;if(e.interactionWrapper)return m(e.interactionWrapper,a);var b=h(a,"getParent")?a.getParent():null;return b&&p(b)?m(b,a):(b=t(a))?m(b,a):null}function m(a,b){var c=g(a,"class"),d=g(b,"data-serial");g(b,"data-qti-class");return{wrapper:a,placeholder:k(f.placeholderTemplate,{className:c,serialId:d||""})}}function p(a){if(!a)return!1;try{if(!h(a,"getName")||"div"!==a.getName()||g(a,"data-qti-class"))return!1;for(var b=g(a,"class",""),c=["col-","grid-row","qti-itemBody",
"item-editor-drop-area"],d=0;d<c.length;d++)if(-1!==b.indexOf(c[d]))return!1;if(g(a,"data-units"))return!1;if(h(a,"hasClass")&&a.hasClass("custom-interaction-wrapper"))return!0;if(h(a,"getChildren"))for(var e=a.getChildren(),d=0;d<e.count();d++){var f=e.getItem(d);if(h(f,"getAttribute")&&(f.getAttribute("data-qti-class")||f.getAttribute("data-serial")&&0===f.getAttribute("data-serial").indexOf("interaction_")))return!0}return!1}catch(k){return!1}}function t(a){if(!h(a,"getParent"))return null;try{for(var b=
5;a&&0<b;){var c=a.getParent();if(p(c)&&(h(c,"hasClass")&&c.hasClass("custom-interaction-wrapper")||g(c,"class")&&!g(c,"data-serial")&&!g(c,"data-html-editable")))return c;a=c;b--}return null}catch(d){return console.error("Error in findClosestWrapperDiv:",d),null}}function n(){h(e,"findInteractionAndWrapper")&&e.findInteractionAndWrapper()}function u(a,b){var c=g(a,"data-serial");g(a,"data-qti-class");c=c||"";return e.lastInteractionHasWrapper&&e.lastWrapperClass&&!b?k(f.placeholderTemplate,{className:e.lastWrapperClass,
serialId:c}):b?b.placeholder:k(f.simpleTemplate,{serialId:c})}var f={size:{width:Math.min(CKEDITOR.document.getWindow().getViewPaneSize().width-70,800),height:CKEDITOR.document.getWindow().getViewPaneSize().height/1.5},placeholderTemplate:'\x3cdiv class\x3d"{{className}}"\x3e\n\x3cinteraction_{{serialId}}\x3e\n\x3c/div\x3e',simpleTemplate:"\x3cinteraction_{{serialId}}\x3e",css:{wrapperInfo:"margin-bottom: 10px; padding: 5px; border-left: 3px solid #ccc; background-color: #f9f9f9;",example:"margin: 3px 0 0; color: #666; font-style: italic;",
codeBlock:"display: block; margin-top: 5px; padding: 5px; background: #f0f0f0; border: 1px solid #ddd; font-family: monospace;",textarea:"cursor:auto; width:100%; min-width:{{width}}px; max-width:unset; height:{{height}}px; tab-size:4; text-align:left; font-family:monospace;"}},q=null;return{title:e.lang.interactionsource.title,minWidth:600,minHeight:400,resizable:CKEDITOR.DIALOG_RESIZE_BOTH,onShow:function(){var a=this;n();var b=e.interactionElement;if(b)try{var c=r(b),d=u(b,c);this.setValueOf("main",
"data",d);q=d}catch(f){console.error("Error getting simplified interaction HTML:",f),l(e,"Error retrieving simplified interaction HTML: "+f.message),setTimeout(function(){a.hide()},0)}else l(e,"No interaction found or not currently editing an interaction."),setTimeout(function(){a.hide()},0)},onOk:function(){var a=this;if(this.getValueOf("main","data").replace(/\r/g,"")===q)return!0;setTimeout(function(){e.focus();try{var b=a.getValueOf("main","data");if(!b)throw Error("No edited data available");
if(!e.interactionElement)throw Error("Interaction element not found.");var c=/^\s*<div[^>]*>([\s\S]*)<\/div>\s*$/i.test(b);if(e.lastInteractionHasWrapper=c){var d=b.match(/^\s*<div[^>]*class=["']([^"']*)["'][^>]*>/i);d&&d[1]&&(e.lastWrapperClass=d[1])}a.hide();e.fire("pluginContentModified",{html:b,pluginName:"interactionsourcedialog"})}catch(f){console.error("Error applying changes:",f),l(e,"Error updating interaction: "+f.message)}});return!1},contents:[{id:"main",label:e.lang.interactionsource.title,
elements:[{type:"html",id:"wrapperInfo",html:function(){var a=e.lang.interactionsource;return'\x3cdiv id\x3d"interaction-wrapper-info" style\x3d"'+f.css.wrapperInfo+'"\x3e\x3cp style\x3d"'+f.css.example+'"\x3e'+a.wrapperExample+'\x3cbr\x3e\x3ccode style\x3d"'+f.css.codeBlock+'"\x3e\x26lt;div class\x3d"foobar"\x26gt;\x3cbr\x3e\x26nbsp;\x26nbsp;\x26lt;interaction_serial_number\x26gt;\x3cbr\x3e\x26lt;/div\x26gt;\x3c/code\x3e\x3c/p\x3e\x3cp style\x3d"'+f.css.example+'"\x3e\x3cem\x3e'+a.styleEditorNote+
"\x3c/em\x3e\x3c/p\x3e\x3c/div\x3e"}()},{type:"textarea",id:"data",dir:"ltr",inputStyle:k(f.css.textarea,f.size),"class":"cke_source"}]}]}});