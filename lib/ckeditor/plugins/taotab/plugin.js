CKEDITOR.plugins.add("taotab",{lang:"de,en,fr,nl",init:function(e){function g(b){var d,a="";b=parseInt(b||4,10);for(d=0;d<b;d++)a+=String.fromCharCode(160);return a}function f(b){var d,a=[];for(d=0;d<b.childNodes.length;d++){var c=b.childNodes[d];c.nodeType===Node.TEXT_NODE?a.push(c):c.nodeType===Node.ELEMENT_NODE&&(a=a.concat(f(c)))}return a}e.addCommand("insertTab",{exec:function(b){var d=b.getSelection(),a=d.getRanges(),c=new CKEDITOR.dom.text(d._.cache.nativeSel.focusNode),e=c.getText();if(null===
e){c=f(a[0].root.$);b.insertHtml(g(4));a:{a=f(a[0].root.$);for(b=0;b<a.length;b++)if(!c[b]){a=a[b];break a}else if(!a[b].isEqualNode(c[b])){a=a[b];break a}a=void 0}c=new CKEDITOR.dom.text(a);a=d.getRanges();a[0].setStart(c,3);a[0].setEnd(c,3);d.selectRanges([a[0]]);a[0].setStart(c,4);a[0].setEnd(c,4)}else b=a[0].startOffset,c.setText([e.slice(0,b),g(4),e.slice(b)].join("")),a[0].setStart(c,b+4),a[0].setEnd(c,b+4);d.selectRanges([a[0]])}});e.ui.addButton("TaoTab",{label:e.lang.insertTab.button,command:"insertTab",
icon:this.path+"images/taotab.png"})}});